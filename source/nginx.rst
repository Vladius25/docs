=============================
Настройка веб-сервера Nginx
=============================

Определение
========================

Понятие **веб-сервер** может относиться как к аппаратной начинке, так и к программному обеспечению. Или даже к обеим частям, работающим совместно.

1. С точки зрения "железа", **веб-сервер** — это компьютер, который хранит файлы сайта (HTML-документы, CSS-стили, JavaScript-файлы, картинки и другие) и доставляет их на устройство конечного пользователя (веб-браузер и т.д.). Он подключен к сети Интернет и может быть доступен через доменное имя, подобное ``school9.perm.ru``.

2. С точки зрения ПО, **веб-сервер** включает в себя несколько компонентов, которые контролируют доступ веб-пользователей к размещенным на сервере файлам, как минимум — это HTTP-сервер. HTTP-сервер — это часть ПО, которая понимает URL’ы (веб-адреса) и HTTP (протокол, который ваш браузер использует для просмотра веб-страниц).

На самом базовом уровне, когда браузеру нужен файл, размещенный на веб-сервере, браузер запрашивает его через HTTP-протокол. Когда запрос достигает нужного веб-сервера ("железо"), сервер HTTP (ПО) принимает запрос, находит запрашиваемый документ (если нет, то сообщает об ошибке ``404``) и отправляет обратно, также через HTTP.

.. image:: _static/images/web-server.png

Популярное ПО
===================

**Apache** и **Nginx** — 2 самых широко распространенных веб-сервера с открытым исходным кодом в мире (`см. здесь <https://w3techs.com/technologies/overview/web_server/all>`_). Вместе они обслуживают большую часть трафика во всем интернете. Оба решения способны работать с разнообразными рабочими нагрузками и взаимодействовать с другими приложениями для реализации полного веб-стека.

Apache
-------------------

**Apache HTTP Server** был разработан *Робертом Маккулом* в 1995 году, а с 1999 года разрабатывается под управлением *Apache Software Foundation* — фонда развития программного обеспечения Apache. Так как HTTP сервер это первый и самый популярный проект фонда его обычно называют просто Apache.

Веб-север Apache был самым популярным веб-сервером в интернете с 1996 года. Благодаря его популярности у Apache сильная документация и интеграция со сторонним софтом

Nginx (Engine X)
--------------------

**Nginx** был разработан *Игорем Сысоевым* в 2002 году и начал набирать популярность с момента релиза благодаря своей легковесности и возможности легко масштабироваться на минимальном железе. Nginx превосходен при отдаче статического контента и спроектирован так, чтобы передавать динамические запросы другому ПО предназначенному для их обработки.

**Nginx** позиционируется производителем как простой, быстрый и надёжный сервер, не перегруженный функциями.

Что лучше?
---------------------

**Apache** и **Nginx** имеют очень много схожих качеств, но их нельзя рассматривать как взаимозаменяемые. Каждый веб-сервер имеет свои особенности, и поэтому лучше всего подходит для определенных ситуаций. В интернете вы можете найти множество статей, объясняющих преимущества каждого.

О данной иструкции
=====================

**Nginx** изначально умел очень мало и позиционировался как быстрый http-сервер для отдачи статики. Cейчас он умеет почти все, что и **Apache**. При этом первый менее ресурсоемкий и гораздо проще в настройке.

Выполнять его установку и настройку будем на дистрибутиве **CentOS 7**, который часто использутеся в качестве серверной ОС. Для других дистрибутивов процесс практически идентичен. Вам будет необходимо подключиться по ``ssh`` (:ref:`см. здесь <ssh>`) к хосту ``kojima.sch9.lan`` на порт ``50XX``, где *XX* - номер вашего компьютера. Заходите под пользователем *root* с паролем *toor*. Пароль можно сразу изменить (:ref:`cм. здесь <passwd>`).

К слову, сайт школы работает именно на такой конфигурации: **Nginx** и **CentOS 7**. 

.. note::

   1. В тексте используется символ ``$``. Это общепринятое обозначение комманд, которые нужно выполнять с правами *суперпользователя*.
   2. В тексте используется слово ``контейнер``. Воспринимайте его как особым образом подготовленное для учебных целей окружение. 

Установка
=====================

Установим пакет Nginx из репозитория (:ref:`см. здесь <repos>`):

.. prompt:: bash $

    yum install nginx

Запустим веб-сервер и сразу добавим его в автозагрузку, чтобы он автоматически запускался при старте ОС. Для этого используем ``Systemd`` (:ref:`см. здесь <systemd>`):

.. prompt:: bash $
   
    systemctl start nginx
    systemctl enable nginx

.. warning::

   В учебных целях мы используем контейнеры, поэтому ``Systemd`` в системе нет. Данный шаг следует пропустить.

Откроем порты ``80`` *(http)* и ``443`` *(https)* в фаерволе:

.. prompt:: bash $

   firewall-cmd --permanent --add-service=http
   firewall-cmd --permanent --add-service=https
   firewall-cmd --reload

Уже можно посмотреть, что получилось. Откройте браузер и зайдите на ``http://kojima.sch9.lan:50XX/``, где *XX* - номер вашего компьютера. Порт ``50XX`` в данном случае перенаправляется на порт ``80`` вашего контейнера.


